<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VN Shop Acc â€“ Mua BÃ¡n TÃ i Khoáº£n Game</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#050810;--surface:#0d1117;--surface2:#111827;--surface3:#1a2235;
  --border:rgba(99,179,237,0.12);--accent:#00d4ff;--accent2:#7c3aed;
  --gold:#f59e0b;--danger:#ef4444;--success:#10b981;--text:#e2e8f0;--muted:#6b7280;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Be Vietnam Pro',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 50% -10%,rgba(0,212,255,0.06),transparent);pointer-events:none;z-index:0}

/* â”€â”€ NAV â”€â”€ */
nav{position:fixed;top:0;width:100%;z-index:200;backdrop-filter:blur(20px);background:rgba(5,8,16,0.9);border-bottom:1px solid var(--border)}
.nav-inner{max-width:1280px;margin:0 auto;height:58px;display:flex;align-items:center;justify-content:space-between;padding:0 20px}
.logo{font-family:'Rajdhani',sans-serif;font-size:1.55rem;font-weight:700;color:var(--accent);letter-spacing:2px;cursor:pointer;text-shadow:0 0 20px rgba(0,212,255,.3)}
.logo span{color:var(--gold)}
.nav-right{display:flex;align-items:center;gap:10px;flex-wrap:nowrap}
.btn{display:inline-flex;align-items:center;gap:7px;padding:8px 15px;border-radius:8px;border:none;cursor:pointer;font-family:'Be Vietnam Pro',sans-serif;font-size:.83rem;font-weight:500;transition:all .2s;white-space:nowrap}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 4px 14px rgba(0,212,255,.2)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,212,255,.35)}
.btn-outline{background:transparent;border:1px solid var(--border);color:var(--text)}
.btn-outline:hover{border-color:var(--accent);color:var(--accent)}
.btn-gold{background:linear-gradient(135deg,#f59e0b,#d97706);color:#000;font-weight:600}
.btn-gold:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(245,158,11,.3)}
.btn-danger{background:var(--danger);color:#fff}
.btn-success{background:var(--success);color:#fff}
.btn-sm{padding:5px 11px;font-size:.78rem}
.btn-xs{padding:3px 8px;font-size:.73rem}
.user-chip{display:flex;align-items:center;gap:7px;background:var(--surface2);border:1px solid var(--border);border-radius:20px;padding:3px 11px 3px 3px;font-size:.8rem}
.user-avatar{width:26px;height:26px;border-radius:50%;border:2px solid var(--accent)}
.balance-chip{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.3);border-radius:20px;padding:4px 11px;font-size:.8rem;color:var(--gold);font-weight:600}
.admin-badge{background:linear-gradient(135deg,var(--gold),#d97706);color:#000;font-size:.62rem;font-weight:700;padding:2px 6px;border-radius:4px;letter-spacing:.5px}

/* â”€â”€ SECTIONS â”€â”€ */
.section{display:none}.section.active{display:block}
.container{max-width:1280px;margin:0 auto;padding:74px 20px 50px}

/* â”€â”€ GAME TABS â”€â”€ */
.game-tabs{display:flex;gap:6px;overflow-x:auto;padding:4px 0 10px;scrollbar-width:none;-webkit-scrollbar:{display:none}}
.game-tabs::-webkit-scrollbar{display:none}
.game-tab{display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 16px;border-radius:12px;border:1.5px solid var(--border);background:var(--surface);cursor:pointer;transition:all .2s;min-width:80px;white-space:nowrap;font-size:.75rem;color:var(--muted)}
.game-tab .icon{font-size:1.6rem}
.game-tab:hover,.game-tab.active{border-color:var(--accent);color:var(--accent);background:rgba(0,212,255,.06);box-shadow:0 0 16px rgba(0,212,255,.1)}
.game-tab.active{font-weight:600}

/* â”€â”€ GRID â”€â”€ */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
.acc-card{background:var(--surface);border:1.5px solid var(--border);border-radius:16px;overflow:hidden;transition:all .28s;cursor:pointer;position:relative}
.acc-card:hover{border-color:rgba(0,212,255,.35);transform:translateY(-4px);box-shadow:0 14px 40px rgba(0,0,0,.45)}
.acc-card.sold{opacity:.45;pointer-events:none}
.card-img-wrap{position:relative;height:165px;overflow:hidden;background:linear-gradient(135deg,#1a2040,#0a0f1e)}
.card-img-wrap img{width:100%;height:100%;object-fit:cover;transition:transform .4s}
.acc-card:hover .card-img-wrap img{transform:scale(1.05)}
.card-img-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3.5rem}
.card-overlay{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(transparent,rgba(5,8,16,.85))}
.card-game-badge{position:absolute;top:8px;left:8px;padding:3px 8px;border-radius:6px;font-size:.68rem;font-weight:700;letter-spacing:.5px}
.card-status-badge{position:absolute;top:8px;right:8px;padding:3px 9px;border-radius:20px;font-size:.68rem;font-weight:600}
.badge-hot{background:rgba(239,68,68,.85);color:#fff}
.badge-new{background:rgba(16,185,129,.85);color:#fff}
.badge-sold{background:rgba(100,100,100,.7);color:#ccc}
.card-body{padding:14px}
.card-title{font-family:'Rajdhani',sans-serif;font-size:1.05rem;font-weight:700;margin-bottom:4px;line-height:1.2}
.card-desc{font-size:.76rem;color:var(--muted);margin-bottom:10px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.card-tags{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px}
.tag{padding:2px 7px;border-radius:4px;font-size:.68rem;background:rgba(124,58,237,.15);color:#a78bfa;border:1px solid rgba(124,58,237,.2)}
.card-footer{display:flex;align-items:center;justify-content:space-between}
.price{font-family:'Rajdhani',sans-serif;font-size:1.35rem;font-weight:700;color:var(--gold)}

/* â”€â”€ GAME COLORS â”€â”€ */
.game-lienquan{background:rgba(0,140,255,.2);color:#60c0ff}
.game-freefire{background:rgba(255,100,0,.2);color:#ff8040}
.game-fcmobile{background:rgba(0,200,80,.2);color:#40e080}
.game-roblox{background:rgba(220,50,50,.2);color:#ff7070}
.game-pubg{background:rgba(200,160,0,.2);color:#f0c040}
.game-genshin{background:rgba(120,0,220,.2);color:#c080ff}
.game-valorant{background:rgba(255,60,80,.2);color:#ff8090}
.game-other{background:rgba(100,100,100,.2);color:#aaa}

/* â”€â”€ FILTER â”€â”€ */
.filter-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;align-items:center}
.filter-btn{padding:5px 14px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;font-size:.78rem;transition:all .2s;font-family:'Be Vietnam Pro',sans-serif}
.filter-btn.active,.filter-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(0,212,255,.05)}
.search-input{flex:1;min-width:160px;max-width:280px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:7px 13px;font-family:'Be Vietnam Pro',sans-serif;font-size:.83rem}
.search-input:focus{outline:none;border-color:var(--accent)}

/* â”€â”€ TABS â”€â”€ */
.tabs{display:flex;gap:3px;background:var(--surface2);border-radius:10px;padding:3px;margin-bottom:20px;overflow-x:auto}
.tab{flex:none;text-align:center;padding:8px 16px;border-radius:7px;cursor:pointer;font-size:.82rem;transition:all .2s;border:none;background:none;color:var(--muted);font-family:'Be Vietnam Pro',sans-serif;white-space:nowrap}
.tab.active{background:var(--surface);color:var(--text);box-shadow:0 2px 8px rgba(0,0,0,.3)}

/* â”€â”€ PANEL â”€â”€ */
.panel{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:20px}
.panel-title{font-family:'Rajdhani',sans-serif;font-size:1.15rem;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px}
.panel-title::before{content:'';width:4px;height:18px;background:var(--accent);border-radius:2px;flex-shrink:0}

/* â”€â”€ FORM â”€â”€ */
.form-group{margin-bottom:14px}
label{display:block;font-size:.8rem;color:var(--muted);margin-bottom:5px;font-weight:500}
input,select,textarea{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:10px 13px;font-family:'Be Vietnam Pro',sans-serif;font-size:.86rem;transition:border-color .2s}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent)}
select option{background:var(--surface2)}
textarea{resize:vertical;min-height:80px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:520px){.form-row{grid-template-columns:1fr}}

/* â”€â”€ IMAGE UPLOAD â”€â”€ */
.img-upload-box{border:2px dashed var(--border);border-radius:12px;padding:28px;text-align:center;cursor:pointer;transition:all .2s;position:relative}
.img-upload-box:hover{border-color:var(--accent);background:rgba(0,212,255,.03)}
.img-upload-box input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-upload-preview{width:100%;height:180px;object-fit:cover;border-radius:10px;margin-bottom:8px;display:none}
.img-upload-icon{font-size:2.2rem;margin-bottom:8px}
.img-upload-text{font-size:.82rem;color:var(--muted)}
.img-upload-text strong{color:var(--accent)}

/* â”€â”€ TABLE â”€â”€ */
.table{width:100%;border-collapse:collapse;font-size:.81rem}
.table th{text-align:left;padding:8px 12px;color:var(--muted);border-bottom:1px solid var(--border);font-weight:500;white-space:nowrap}
.table td{padding:9px 12px;border-bottom:1px solid rgba(255,255,255,.03);vertical-align:middle}
.table tr:hover td{background:rgba(255,255,255,.015)}

/* â”€â”€ MODAL â”€â”€ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:500;display:none;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(8px)}
.overlay.open{display:flex;animation:fadeIn .2s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:20px;width:100%;max-width:540px;max-height:92vh;overflow-y:auto;animation:slideUp .25s ease}
@keyframes slideUp{from{transform:translateY(24px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-wide{max-width:740px}
.modal-header{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--surface);z-index:10}
.modal-title{font-family:'Rajdhani',sans-serif;font-size:1.2rem;font-weight:700}
.modal-body{padding:22px}
.close-x{background:none;border:none;color:var(--muted);cursor:pointer;font-size:1.3rem;line-height:1;padding:2px 6px;border-radius:4px}
.close-x:hover{color:var(--text);background:var(--surface2)}

/* â”€â”€ UID BOX â”€â”€ */
.uid-box{background:linear-gradient(135deg,rgba(0,212,255,.08),rgba(124,58,237,.08));border:1px solid rgba(0,212,255,.2);border-radius:12px;padding:18px;text-align:center}
.uid-code{font-family:'Rajdhani',sans-serif;font-size:2.2rem;font-weight:700;color:var(--accent);letter-spacing:6px;margin:4px 0}

/* â”€â”€ RECHARGE â”€â”€ */
.recharge-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.recharge-card{background:var(--surface2);border:1.5px solid var(--border);border-radius:12px;padding:18px;cursor:pointer;text-align:center;transition:all .2s}
.recharge-card:hover,.recharge-card.sel{border-color:var(--accent);background:rgba(0,212,255,.05)}
.recharge-card .ri{font-size:2rem;margin-bottom:6px}

/* â”€â”€ TOAST â”€â”€ */
.toast-wrap{position:fixed;bottom:20px;right:20px;z-index:999;display:flex;flex-direction:column;gap:8px;max-width:300px}
.toast{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:11px 15px;font-size:.83rem;display:flex;align-items:center;gap:9px;animation:toastIn .3s ease;box-shadow:0 6px 20px rgba(0,0,0,.4)}
.toast.s{border-color:rgba(16,185,129,.35);background:rgba(16,185,129,.08)}
.toast.e{border-color:rgba(239,68,68,.35);background:rgba(239,68,68,.08)}
@keyframes toastIn{from{transform:translateX(110%)}to{transform:translateX(0)}}

/* â”€â”€ LOGIN PAGE â”€â”€ */
.login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;position:relative;z-index:1}
.login-card{background:rgba(13,17,23,.92);border:1px solid rgba(99,179,237,.18);border-radius:24px;padding:36px;max-width:420px;width:100%;backdrop-filter:blur(24px);box-shadow:0 24px 80px rgba(0,0,0,.6)}
.g-btn{display:flex;align-items:center;justify-content:center;gap:13px;width:100%;padding:15px;background:#fff;color:#1f2937;border-radius:12px;border:none;cursor:pointer;font-size:.97rem;font-weight:600;font-family:'Be Vietnam Pro',sans-serif;transition:all .22s;box-shadow:0 4px 20px rgba(0,0,0,.35)}
.g-btn:hover{background:#f1f5f9;transform:translateY(-1px)}
.g-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}

/* â”€â”€ NO ITEMS â”€â”€ */
.empty{text-align:center;padding:50px 20px;color:var(--muted)}
.empty .ei{font-size:3rem;margin-bottom:12px}

/* â”€â”€ ACC DETAIL â”€â”€ */
.detail-img{width:100%;height:220px;object-fit:cover;border-radius:12px;margin-bottom:16px}
.detail-img-ph{height:180px;background:var(--surface2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:4rem;margin-bottom:16px}
.info-row{display:flex;justify-content:space-between;padding:9px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.84rem}
.info-row:last-child{border:none}
.info-key{color:var(--muted)}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:600px){
  .recharge-grid{grid-template-columns:1fr}
  .grid{grid-template-columns:1fr 1fr}
  .nav-inner{padding:0 12px}
  .logo{font-size:1.3rem}
}
@media(max-width:400px){.grid{grid-template-columns:1fr}}

/* â”€â”€ ANIM â”€â”€ */
@keyframes bgp{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.12);opacity:.5}}
@keyframes spin2{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin2 1s linear infinite}

/* â”€â”€ ADMIN STATS â”€â”€ */
.a-stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:20px}
.a-stat{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center}
.a-stat-val{font-family:'Rajdhani',sans-serif;font-size:1.8rem;font-weight:700;color:var(--accent)}
.a-stat-lbl{font-size:.73rem;color:var(--muted);margin-top:2px}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-inner">
    <div class="logo" onclick="goHome()">VN<span>SHOP</span></div>
    <div class="nav-right" id="navRight">
      <button class="btn btn-primary" onclick="loginWithGoogle()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:15px;height:15px">
        ÄÄƒng nháº­p Google
      </button>
    </div>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â• LOGIN PAGE â•â•â•â•â•â•â•â• -->
<div id="secLogin" class="section active">
  <div class="login-page">
    <div style="position:fixed;inset:0;overflow:hidden;pointer-events:none">
      <div style="position:absolute;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(0,212,255,.07),transparent);top:-150px;left:-150px;animation:bgp 7s ease-in-out infinite"></div>
      <div style="position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(124,58,237,.06),transparent);bottom:-200px;right:-200px;animation:bgp 9s ease-in-out infinite reverse"></div>
    </div>
    <div style="position:relative;z-index:1;width:100%;max-width:420px">
      <div style="text-align:center;margin-bottom:32px">
        <div style="font-family:'Rajdhani',sans-serif;font-size:3rem;font-weight:700;color:var(--accent);letter-spacing:4px;text-shadow:0 0 40px rgba(0,212,255,.4)">VN<span style="color:var(--gold)">SHOP</span></div>
        <div style="font-size:.78rem;color:var(--muted);letter-spacing:3px;text-transform:uppercase;margin-top:4px">Mua BÃ¡n TÃ i Khoáº£n Game</div>
      </div>
      <div class="login-card">
        <!-- game icons row -->
        <div style="display:flex;justify-content:center;gap:10px;margin-bottom:22px;flex-wrap:wrap">
          <span title="LiÃªn QuÃ¢n" style="font-size:1.8rem">âš”ï¸</span>
          <span title="Free Fire" style="font-size:1.8rem">ğŸ”¥</span>
          <span title="FC Mobile" style="font-size:1.8rem">âš½</span>
          <span title="Roblox" style="font-size:1.8rem">ğŸ®</span>
          <span title="PUBG" style="font-size:1.8rem">ğŸ¯</span>
          <span title="Genshin" style="font-size:1.8rem">âœ¨</span>
          <span title="Valorant" style="font-size:1.8rem">ğŸ’¥</span>
        </div>
        <div style="text-align:center;margin-bottom:26px">
          <div style="font-family:'Rajdhani',sans-serif;font-size:1.6rem;font-weight:700;margin-bottom:5px">ChÃ o má»«ng! ğŸ‘‹</div>
          <div style="font-size:.83rem;color:var(--muted)">ÄÄƒng nháº­p Ä‘á»ƒ mua acc & náº¡p tiá»n</div>
        </div>
        <div style="display:flex;justify-content:space-around;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:13px;margin-bottom:24px">
          <div style="text-align:center"><div style="font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;color:var(--accent)" id="lStat1">â€”</div><div style="font-size:.67rem;color:var(--muted)">TÃ i khoáº£n</div></div>
          <div style="width:1px;background:var(--border)"></div>
          <div style="text-align:center"><div style="font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;color:var(--gold)" id="lStat2">â€”</div><div style="font-size:.67rem;color:var(--muted)">ÄÃ£ bÃ¡n</div></div>
          <div style="width:1px;background:var(--border)"></div>
          <div style="text-align:center"><div style="font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;color:var(--success)">7</div><div style="font-size:.67rem;color:var(--muted)">TrÃ² chÆ¡i</div></div>
        </div>
        <button class="g-btn" id="gBtn" onclick="loginWithGoogle()">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:22px;height:22px">
          ÄÄƒng nháº­p báº±ng Google
        </button>
        <div id="gLoad" style="display:none;text-align:center;margin-top:12px;font-size:.82rem;color:var(--muted)">
          <span class="spin">â³</span> Äang má»Ÿ Google...
        </div>
        <p style="text-align:center;font-size:.71rem;color:var(--muted);margin-top:18px;line-height:1.7">ChÃºng tÃ´i khÃ´ng lÆ°u máº­t kháº©u cá»§a báº¡n.<br>Giao dá»‹ch báº£o máº­t &amp; uy tÃ­n.</p>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• USER SHOP â•â•â•â•â•â•â•â• -->
<div id="secShop" class="section">
  <div class="container">
    <!-- Game Tabs -->
    <div class="game-tabs" id="gameTabs">
      <div class="game-tab active" data-game="all" onclick="selectGame('all',this)"><div class="icon">ğŸ†</div>Táº¥t cáº£</div>
      <div class="game-tab" data-game="lienquan" onclick="selectGame('lienquan',this)"><div class="icon">âš”ï¸</div>LiÃªn QuÃ¢n</div>
      <div class="game-tab" data-game="freefire" onclick="selectGame('freefire',this)"><div class="icon">ğŸ”¥</div>Free Fire</div>
      <div class="game-tab" data-game="fcmobile" onclick="selectGame('fcmobile',this)"><div class="icon">âš½</div>FC Mobile</div>
      <div class="game-tab" data-game="roblox" onclick="selectGame('roblox',this)"><div class="icon">ğŸ®</div>Roblox</div>
      <div class="game-tab" data-game="pubg" onclick="selectGame('pubg',this)"><div class="icon">ğŸ¯</div>PUBG Mobile</div>
      <div class="game-tab" data-game="genshin" onclick="selectGame('genshin',this)"><div class="icon">âœ¨</div>Genshin</div>
      <div class="game-tab" data-game="valorant" onclick="selectGame('valorant',this)"><div class="icon">ğŸ’¥</div>Valorant</div>
      <div class="game-tab" data-game="other" onclick="selectGame('other',this)"><div class="icon">ğŸ²</div>KhÃ¡c</div>
    </div>

    <!-- Filter row -->
    <div class="filter-row">
      <input class="search-input" id="searchBox" placeholder="ğŸ” TÃ¬m kiáº¿m..." oninput="applyFilter()">
      <button class="filter-btn active" data-type="all" onclick="setType('all',this)">Táº¥t cáº£</button>
      <button class="filter-btn" data-type="vip" onclick="setType('vip',this)">ğŸ‘‘ VIP</button>
      <button class="filter-btn" data-type="rank" onclick="setType('rank',this)">ğŸ… Rank cao</button>
      <button class="filter-btn" data-type="cheap" onclick="setType('cheap',this)">ğŸ’¸ GiÃ¡ ráº»</button>
    </div>

    <div class="grid" id="shopGrid"><div class="empty"><div class="ei">âš”ï¸</div>Äang táº£i...</div></div>

    <!-- Bottom tabs -->
    <div style="height:20px"></div>
    <div class="tabs" id="userTabs">
      <button class="tab active" onclick="uTab('shop')">ğŸ›’ Shop</button>
      <button class="tab" onclick="uTab('recharge')">ğŸ’³ Náº¡p tiá»n</button>
      <button class="tab" onclick="uTab('history')">ğŸ“‹ Lá»‹ch sá»­</button>
      <button class="tab" onclick="uTab('profile')">ğŸ‘¤ TÃ´i</button>
    </div>

    <!-- RECHARGE -->
    <div id="uTabRecharge" style="display:none">
      <div class="panel">
        <div class="uid-box" style="margin-bottom:0">
          <div style="font-size:.78rem;color:var(--muted)">MÃ£ tÃ i khoáº£n cá»§a báº¡n</div>
          <div class="uid-code" id="myUID">â€”â€”</div>
          <div style="font-size:.73rem;color:var(--muted);margin-bottom:10px">Gá»­i mÃ£ nÃ y cho admin Ä‘á»ƒ Ä‘Æ°á»£c cá»™ng tiá»n</div>
          <button class="btn btn-outline btn-sm" onclick="copyUID()">ğŸ“‹ Sao chÃ©p mÃ£</button>
        </div>
      </div>
      <div class="panel">
        <div class="panel-title">Chá»n phÆ°Æ¡ng thá»©c náº¡p</div>
        <div class="recharge-grid">
          <div class="recharge-card" onclick="selMethod('card',this)"><div class="ri">ğŸ“±</div><div style="font-weight:600;font-size:.88rem">Tháº» cÃ o</div><div style="font-size:.73rem;color:var(--muted);margin-top:3px">Trá»« 20% phÃ­</div></div>
          <div class="recharge-card" onclick="selMethod('bank',this)"><div class="ri">ğŸ¦</div><div style="font-weight:600;font-size:.88rem">Chuyá»ƒn khoáº£n</div><div style="font-size:.73rem;color:var(--muted);margin-top:3px">Nháº­n 100%</div></div>
        </div>
      </div>
      <div class="panel" id="cardFormPanel" style="display:none">
        <div class="panel-title">Náº¡p tháº» cÃ o</div>
        <div class="form-row">
          <div class="form-group"><label>Loáº¡i tháº»</label><select id="cType"><option value="viettel">Viettel</option><option value="garena">Garena</option><option value="zing">Zing Card</option><option value="mobifone">Mobifone</option><option value="vinaphone">Vinaphone</option><option value="vietnamobile">Vietnamobile</option></select></div>
          <div class="form-group"><label>Má»‡nh giÃ¡</label><select id="cVal"><option value="10000">10.000Ä‘ â†’ 8.000Ä‘</option><option value="20000">20.000Ä‘ â†’ 16.000Ä‘</option><option value="50000">50.000Ä‘ â†’ 40.000Ä‘</option><option value="100000">100.000Ä‘ â†’ 80.000Ä‘</option><option value="200000">200.000Ä‘ â†’ 160.000Ä‘</option><option value="500000">500.000Ä‘ â†’ 400.000Ä‘</option></select></div>
        </div>
        <div class="form-group"><label>Sá»‘ seri</label><input id="cSerial" placeholder="Nháº­p sá»‘ seri tháº»"></div>
        <div class="form-group"><label>MÃ£ tháº»</label><input id="cCode" placeholder="Nháº­p mÃ£ tháº»"></div>
        <div style="background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.2);border-radius:8px;padding:10px 13px;font-size:.78rem;color:#fbbf24;margin-bottom:14px">âš ï¸ Tháº» cÃ o bá»‹ trá»« 20% phÃ­. Admin xÃ¡c nháº­n trong 30 phÃºt.</div>
        <button class="btn btn-primary" onclick="submitCard()" style="width:100%">Gá»­i tháº» náº¡p</button>
      </div>
      <div class="panel" id="bankFormPanel" style="display:none">
        <div class="panel-title">ThÃ´ng tin chuyá»ƒn khoáº£n</div>
        <div style="background:var(--surface2);border-radius:12px;padding:16px;margin-bottom:14px">
          <div class="info-row"><span class="info-key">NgÃ¢n hÃ ng</span><strong>MB Bank</strong></div>
          <div class="info-row"><span class="info-key">Sá»‘ tÃ i khoáº£n</span><span style="color:var(--accent);font-weight:700">0123456789</span></div>
          <div class="info-row"><span class="info-key">Chá»§ TK</span><strong>NGUYEN PHUC</strong></div>
          <div class="info-row"><span class="info-key">Ná»™i dung</span><strong style="color:var(--gold)" id="bankNote">Náº P TIá»€N [UID]</strong></div>
        </div>
        <div style="background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.2);border-radius:8px;padding:10px 13px;font-size:.78rem;color:#6ee7b7">âœ… Nháº­n 100% giÃ¡ trá»‹. Admin cá»™ng tiá»n trong 5-15 phÃºt.</div>
      </div>
    </div>

    <!-- HISTORY -->
    <div id="uTabHistory" style="display:none">
      <div class="panel">
        <div class="panel-title">Lá»‹ch sá»­ giao dá»‹ch</div>
        <div style="overflow-x:auto">
          <table class="table"><thead><tr><th>Thá»i gian</th><th>Loáº¡i</th><th>Sá»‘ tiá»n</th><th>Tráº¡ng thÃ¡i</th></tr></thead>
          <tbody id="histBody"><tr><td colspan="4" class="empty" style="padding:20px">ChÆ°a cÃ³ giao dá»‹ch</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- PROFILE -->
    <div id="uTabProfile" style="display:none">
      <div class="panel">
        <div style="display:flex;align-items:center;gap:14px;margin-bottom:20px">
          <img id="pAvatar" src="" style="width:56px;height:56px;border-radius:50%;border:2px solid var(--accent)">
          <div><div style="font-weight:700;font-size:1.05rem" id="pName"></div><div style="font-size:.8rem;color:var(--muted)" id="pEmail"></div></div>
        </div>
        <div class="uid-box" style="margin-bottom:16px">
          <div style="font-size:.75rem;color:var(--muted)">MÃ£ tÃ i khoáº£n</div>
          <div class="uid-code" id="pUID"></div>
        </div>
        <div class="info-row"><span class="info-key">Sá»‘ dÆ°</span><span style="color:var(--gold);font-weight:700;font-size:1.1rem" id="pBal"></span></div>
        <div class="info-row"><span class="info-key">Tá»•ng Ä‘Ã£ náº¡p</span><span id="pIn"></span></div>
        <div class="info-row"><span class="info-key">Tá»•ng Ä‘Ã£ chi</span><span id="pOut"></span></div>
        <button class="btn btn-outline" onclick="doLogout()" style="width:100%;margin-top:16px">ÄÄƒng xuáº¥t</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• ADMIN â•â•â•â•â•â•â•â• -->
<div id="secAdmin" class="section">
  <div class="container">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap">
      <div style="font-family:'Rajdhani',sans-serif;font-size:1.7rem;font-weight:700">Báº£ng Ä‘iá»u khiá»ƒn</div>
      <span class="admin-badge">ğŸ‘‘ ADMIN</span>
    </div>
    <!-- admin quick stats -->
    <div class="a-stats" id="aStats">
      <div class="a-stat"><div class="a-stat-val" id="asTotalAcc">0</div><div class="a-stat-lbl">Tá»•ng ACC</div></div>
      <div class="a-stat"><div class="a-stat-val" id="asSold">0</div><div class="a-stat-lbl">ÄÃ£ bÃ¡n</div></div>
      <div class="a-stat"><div class="a-stat-val" id="asUsers">0</div><div class="a-stat-lbl">NgÆ°á»i dÃ¹ng</div></div>
      <div class="a-stat"><div class="a-stat-val" id="asPending" style="color:var(--gold)">0</div><div class="a-stat-lbl">Chá» duyá»‡t</div></div>
    </div>

    <div class="tabs" id="adminTabs">
      <button class="tab active" onclick="aTab('accounts')">ğŸ® Quáº£n lÃ½ ACC</button>
      <button class="tab" onclick="aTab('users')">ğŸ‘¥ NgÆ°á»i dÃ¹ng</button>
      <button class="tab" onclick="aTab('recharges')">ğŸ’° Náº¡p tiá»n</button>
      <button class="tab" onclick="aTab('lookup')">ğŸ” Tra mÃ£ & Cá»™ng tiá»n</button>
    </div>

    <!-- ACCOUNTS -->
    <div id="aTabAccounts">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px">
          <div class="panel-title" style="margin:0">Danh sÃ¡ch tÃ i khoáº£n game</div>
          <button class="btn btn-primary btn-sm" onclick="openAddModal()">â• ÄÄƒng ACC má»›i</button>
        </div>
        <!-- game filter for admin -->
        <div class="game-tabs" id="adminGameFilter" style="margin-bottom:14px">
          <div class="game-tab active" data-game="all" onclick="adminFilterGame('all',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">ğŸ†</div><span style="font-size:.7rem">Táº¥t cáº£</span></div>
          <div class="game-tab" data-game="lienquan" onclick="adminFilterGame('lienquan',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">âš”ï¸</div><span style="font-size:.7rem">LiÃªn QuÃ¢n</span></div>
          <div class="game-tab" data-game="freefire" onclick="adminFilterGame('freefire',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">ğŸ”¥</div><span style="font-size:.7rem">Free Fire</span></div>
          <div class="game-tab" data-game="fcmobile" onclick="adminFilterGame('fcmobile',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">âš½</div><span style="font-size:.7rem">FC Mobile</span></div>
          <div class="game-tab" data-game="roblox" onclick="adminFilterGame('roblox',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">ğŸ®</div><span style="font-size:.7rem">Roblox</span></div>
          <div class="game-tab" data-game="pubg" onclick="adminFilterGame('pubg',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">ğŸ¯</div><span style="font-size:.7rem">PUBG</span></div>
          <div class="game-tab" data-game="genshin" onclick="adminFilterGame('genshin',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">âœ¨</div><span style="font-size:.7rem">Genshin</span></div>
          <div class="game-tab" data-game="valorant" onclick="adminFilterGame('valorant',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">ğŸ’¥</div><span style="font-size:.7rem">Valorant</span></div>
          <div class="game-tab" data-game="other" onclick="adminFilterGame('other',this)" style="min-width:60px;padding:8px 12px"><div class="icon" style="font-size:1.2rem">ğŸ²</div><span style="font-size:.7rem">KhÃ¡c</span></div>
        </div>
        <div style="overflow-x:auto">
          <table class="table"><thead><tr><th>áº¢nh</th><th>TÃªn ACC</th><th>Game</th><th>GiÃ¡</th><th>Tráº¡ng thÃ¡i</th><th>HÃ nh Ä‘á»™ng</th></tr></thead>
          <tbody id="aAccBody"><tr><td colspan="6" class="empty" style="padding:20px">ChÆ°a cÃ³ tÃ i khoáº£n</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- USERS -->
    <div id="aTabUsers" style="display:none">
      <div class="panel">
        <div class="panel-title">Danh sÃ¡ch ngÆ°á»i dÃ¹ng</div>
        <div style="overflow-x:auto">
          <table class="table"><thead><tr><th>NgÆ°á»i dÃ¹ng</th><th>Email</th><th>MÃ£ UID</th><th>Sá»‘ dÆ°</th><th>HÃ nh Ä‘á»™ng</th></tr></thead>
          <tbody id="aUserBody"><tr><td colspan="5" class="empty" style="padding:20px">ChÆ°a cÃ³</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- RECHARGES -->
    <div id="aTabRecharges" style="display:none">
      <div class="panel">
        <div class="panel-title">YÃªu cáº§u náº¡p tiá»n</div>
        <div style="overflow-x:auto">
          <table class="table"><thead><tr><th>Thá»i gian</th><th>Email</th><th>UID</th><th>Loáº¡i tháº»</th><th>Má»‡nh giÃ¡</th><th>Nháº­n</th><th>Tráº¡ng thÃ¡i</th><th>Duyá»‡t</th></tr></thead>
          <tbody id="aRBody"><tr><td colspan="8" class="empty" style="padding:20px">ChÆ°a cÃ³</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- LOOKUP -->
    <div id="aTabLookup" style="display:none">
      <div class="panel">
        <div class="panel-title">Tra mÃ£ UID & Cá»™ng tiá»n</div>
        <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap">
          <input id="lookUID" placeholder="Nháº­p mÃ£ UID (VD: ABC123)" style="flex:1;min-width:180px;text-transform:uppercase">
          <button class="btn btn-primary" onclick="doLookup()">ğŸ” Tra cá»©u</button>
        </div>
        <div id="lookResult" style="display:none">
          <div style="background:var(--surface2);border-radius:12px;padding:16px;margin-bottom:14px">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
              <img id="lAvatar" src="" style="width:42px;height:42px;border-radius:50%">
              <div><div style="font-weight:600" id="lName"></div><div style="font-size:.78rem;color:var(--muted)" id="lEmail"></div></div>
            </div>
            <div class="info-row"><span class="info-key">Sá»‘ dÆ° hiá»‡n táº¡i</span><span style="color:var(--gold);font-weight:700;font-size:1.1rem" id="lBal"></span></div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <input type="number" id="addAmt" placeholder="Sá»‘ tiá»n cá»™ng thÃªm (Ä‘)" style="flex:1;min-width:150px">
            <button class="btn btn-success" onclick="doAddBal()">ğŸ’° Cá»™ng tiá»n</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• MODAL: THÃŠM ACC â•â•â•â•â•â•â•â• -->
<div class="overlay" id="addModal">
  <div class="modal modal-wide">
    <div class="modal-header">
      <div class="modal-title" id="addModalTitle">â• ÄÄƒng tÃ i khoáº£n má»›i</div>
      <button class="close-x" onclick="closeOverlay('addModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>ğŸ® Game *</label>
          <select id="nGame">
            <option value="lienquan">âš”ï¸ LiÃªn QuÃ¢n Mobile</option>
            <option value="freefire">ğŸ”¥ Free Fire</option>
            <option value="fcmobile">âš½ FC Mobile</option>
            <option value="roblox">ğŸ® Roblox</option>
            <option value="pubg">ğŸ¯ PUBG Mobile</option>
            <option value="genshin">âœ¨ Genshin Impact</option>
            <option value="valorant">ğŸ’¥ Valorant</option>
            <option value="other">ğŸ² Game khÃ¡c</option>
          </select>
        </div>
        <div class="form-group">
          <label>ğŸ“‚ Loáº¡i *</label>
          <select id="nType">
            <option value="vip">ğŸ‘‘ VIP</option>
            <option value="rank">ğŸ… Rank cao</option>
            <option value="cheap">ğŸ’¸ GiÃ¡ ráº»</option>
            <option value="normal">BÃ¬nh thÆ°á»ng</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ğŸ“ TÃªn tÃ i khoáº£n *</label>
        <input id="nName" placeholder="VD: ACC LiÃªn QuÃ¢n Rank TV - 80 TÆ°á»›ng 30 Skin">
      </div>
      <div class="form-group">
        <label>ğŸ“„ MÃ´ táº£ chi tiáº¿t</label>
        <textarea id="nDesc" placeholder="MÃ´ táº£ chi tiáº¿t: tÆ°á»›ng, skin, rank, server, Ä‘áº·c Ä‘iá»ƒm ná»•i báº­t..."></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ğŸ’° GiÃ¡ bÃ¡n (Ä‘) *</label>
          <input type="number" id="nPrice" placeholder="VD: 150000">
        </div>
        <div class="form-group">
          <label>ğŸ·ï¸ Badge</label>
          <select id="nBadge">
            <option value="new">ğŸ†• Má»›i</option>
            <option value="hot">ğŸ”¥ Hot</option>
            <option value="">KhÃ´ng cÃ³</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ğŸ”– Tags (phÃ¢n cÃ¡ch báº±ng dáº¥u pháº©y)</label>
        <input id="nTags" placeholder="VD: rank thiÃªn vÆ°Æ¡ng, 80 tÆ°á»›ng, 30 skin">
      </div>
      <!-- IMAGE UPLOAD -->
      <div class="form-group">
        <label>ğŸ–¼ï¸ HÃ¬nh áº£nh (táº£i tá»« mÃ¡y lÃªn)</label>
        <div class="img-upload-box" id="uploadBox" onclick="triggerImgPick()">
          <input type="file" id="imgFile" accept="image/*" onchange="onImgPick(event)" style="position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%">
          <img id="imgPreview" class="img-upload-preview" alt="">
          <div id="uploadPlaceholder">
            <div class="img-upload-icon">ğŸ“·</div>
            <div class="img-upload-text">Nháº¥n Ä‘á»ƒ chá»n áº£nh tá»« mÃ¡y<br><strong>Há»— trá»£ JPG, PNG, WebP</strong></div>
          </div>
        </div>
        <div style="font-size:.73rem;color:var(--muted);margin-top:5px">áº¢nh sáº½ Ä‘Æ°á»£c nÃ©n tá»± Ä‘á»™ng. NÃªn dÃ¹ng áº£nh rÃµ nÃ©t vá» acc.</div>
      </div>
      <div class="form-group">
        <label>ğŸ” ThÃ´ng tin Ä‘Äƒng nháº­p ACC (chá»‰ gá»­i sau khi mua)</label>
        <textarea id="nLogin" placeholder="Username / Password / Email / Sá»‘ Ä‘iá»‡n thoáº¡i cá»§a tÃ i khoáº£n game..."></textarea>
      </div>
      <div id="addAccErr" style="color:var(--danger);font-size:.8rem;margin-bottom:10px;display:none"></div>
      <button class="btn btn-primary" onclick="submitAcc()" style="width:100%;padding:13px;font-size:.95rem" id="submitAccBtn">âœ… ÄÄƒng tÃ i khoáº£n</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• MODAL: CHI TIáº¾T ACC â•â•â•â•â•â•â•â• -->
<div class="overlay" id="detailModal">
  <div class="modal modal-wide">
    <div class="modal-header">
      <div class="modal-title" id="dtTitle"></div>
      <button class="close-x" onclick="closeOverlay('detailModal')">âœ•</button>
    </div>
    <div class="modal-body" id="dtBody"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• MODAL: Cá»˜NG TIá»€N TRá»°C TIáº¾P â•â•â•â•â•â•â•â• -->
<div class="overlay" id="directAddModal">
  <div class="modal" style="max-width:380px">
    <div class="modal-header">
      <div class="modal-title">ğŸ’° Cá»™ng tiá»n</div>
      <button class="close-x" onclick="closeOverlay('directAddModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div style="font-size:.83rem;color:var(--muted);margin-bottom:14px" id="dAddFor"></div>
      <div class="form-group"><label>Sá»‘ tiá»n cá»™ng (Ä‘)</label><input type="number" id="dAddAmt" placeholder="Nháº­p sá»‘ tiá»n"></div>
      <button class="btn btn-success" onclick="confirmDirectAdd()" style="width:100%">XÃ¡c nháº­n cá»™ng tiá»n</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- â•â•â•â•â•â•â•â• FIREBASE â•â•â•â•â•â•â•â• -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, set, get, update, push, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const FB = {
  apiKey:"AIzaSyCDQsJ_NrGK5ouRLS7vFr55OBZQ0nKhHSk",
  authDomain:"vietnam-life-game.firebaseapp.com",
  databaseURL:"https://vietnam-life-game-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"vietnam-life-game",
  storageBucket:"vietnam-life-game.firebasestorage.app",
  messagingSenderId:"134954120781",
  appId:"1:134954120781:web:d7f762adb80bfce3140e04",
  measurementId:"G-39VPPE1F9T"
};
const app = initializeApp(FB);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getDatabase(app);
const ADMIN = "nguyenphuc10092012@gmail.com";

// â”€â”€ STATE â”€â”€
let CU = null, CUD = null;
let allAccs = [], currentGame = 'all', currentType = 'all';
let lookupUid = null, lookupFbUid = null;
let directAddTarget = null;
let uploadedImgB64 = null;
let editingKey = null;

// â”€â”€ GAME META â”€â”€
const GAMES = {
  lienquan:{label:'LiÃªn QuÃ¢n Mobile',icon:'âš”ï¸'},
  freefire:{label:'Free Fire',icon:'ğŸ”¥'},
  fcmobile:{label:'FC Mobile',icon:'âš½'},
  roblox:{label:'Roblox',icon:'ğŸ®'},
  pubg:{label:'PUBG Mobile',icon:'ğŸ¯'},
  genshin:{label:'Genshin Impact',icon:'âœ¨'},
  valorant:{label:'Valorant',icon:'ğŸ’¥'},
  other:{label:'Game khÃ¡c',icon:'ğŸ²'}
};

// â”€â”€ HELPERS â”€â”€
function fmt(n){return Number(n||0).toLocaleString('vi-VN')+'Ä‘'}
function genUID(){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';let u='';for(let i=0;i<6;i++)u+=c[Math.floor(Math.random()*c.length)];return u}
function sec(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}

window.showToast=function(msg,type='s'){
  const w=document.getElementById('toastWrap');
  const t=document.createElement('div');t.className=`toast ${type}`;
  t.innerHTML=`<span>${type==='s'?'âœ…':'âŒ'}</span>${msg}`;
  w.appendChild(t);setTimeout(()=>t.remove(),4000);
};
window.closeOverlay=function(id){document.getElementById(id).classList.remove('open')};
window.goHome=function(){if(CU)sec(CU.email===ADMIN?'secAdmin':'secShop');else sec('secLogin')};

// â”€â”€ IMAGE UPLOAD â”€â”€
window.triggerImgPick=function(){document.getElementById('imgFile').click()};
window.onImgPick=function(e){
  const file=e.target.files[0];if(!file)return;
  const maxMB=1.5;
  const reader=new FileReader();
  reader.onload=function(ev){
    // compress via canvas
    const img=new Image();
    img.onload=function(){
      const canvas=document.createElement('canvas');
      let w=img.width,h=img.height;
      const maxW=900,maxH=600;
      if(w>maxW){h=Math.round(h*maxW/w);w=maxW;}
      if(h>maxH){w=Math.round(w*maxH/h);h=maxH;}
      canvas.width=w;canvas.height=h;
      const ctx=canvas.getContext('2d');
      ctx.drawImage(img,0,0,w,h);
      uploadedImgB64=canvas.toDataURL('image/jpeg',0.78);
      // show preview
      const prev=document.getElementById('imgPreview');
      prev.src=uploadedImgB64;prev.style.display='block';
      document.getElementById('uploadPlaceholder').style.display='none';
    };
    img.src=ev.target.result;
  };
  reader.readAsDataURL(file);
};

// â”€â”€ LOGIN â”€â”€
getRedirectResult(auth).then(r=>{if(r?.user)closeOverlay('loginModal')}).catch(()=>{});

window.loginWithGoogle=async function(){
  const btn=document.getElementById('gBtn');
  const ld=document.getElementById('gLoad');
  if(btn){btn.disabled=true;}if(ld)ld.style.display='block';
  const p=new GoogleAuthProvider();p.setCustomParameters({prompt:'select_account'});
  try{await signInWithPopup(auth,p);}
  catch(e){
    if(['auth/popup-blocked','auth/popup-closed-by-user','auth/cancelled-popup-request'].includes(e.code)){
      try{await signInWithRedirect(auth,p);}catch(e2){showToast('Lá»—i: '+e2.message,'e');}
    } else if(e.code!=='auth/cancelled-popup-request'){showToast('Lá»—i Ä‘Äƒng nháº­p: '+e.message,'e');}
    if(btn){btn.disabled=false;}if(ld)ld.style.display='none';
  }
};
window.doLogout=async function(){await signOut(auth)};

onAuthStateChanged(auth,async user=>{
  if(user){
    CU=user;
    await ensureUser(user);
    await loadCUD();
    updateNav();
    if(user.email===ADMIN){sec('secAdmin');loadAdminData();}
    else{sec('secShop');loadShop();}
  } else {
    CU=null;CUD=null;
    sec('secLogin');
    loadLoginStats();
    document.getElementById('navRight').innerHTML=`<button class="btn btn-primary" onclick="loginWithGoogle()"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:15px;height:15px">ÄÄƒng nháº­p Google</button>`;
  }
});

async function ensureUser(u){
  const snap=await get(ref(db,`users/${u.uid}`));
  if(!snap.exists()){
    let uid,tries=0;
    do{uid=genUID();tries++;const c=await get(ref(db,`uidMap/${uid}`));if(!c.exists())break;}while(tries<20);
    const data={name:u.displayName,email:u.email,avatar:u.photoURL,uid,balance:0,totalIn:0,totalOut:0,createdAt:Date.now()};
    await set(ref(db,`users/${u.uid}`),data);
    await set(ref(db,`uidMap/${uid}`),u.uid);
  }
}
async function loadCUD(){const s=await get(ref(db,`users/${CU.uid}`));CUD=s.val();}

function updateNav(){
  const isAdmin=CU.email===ADMIN;
  document.getElementById('navRight').innerHTML=`
    <div class="balance-chip" id="navBal">${fmt(CUD?.balance||0)}</div>
    <div class="user-chip">
      <img src="${CU.photoURL||''}" class="user-avatar">
      <span>${(CU.displayName||'User').split(' ').slice(-1)[0]}</span>
      ${isAdmin?'<span class="admin-badge">Admin</span>':''}
    </div>
    <button class="btn btn-outline btn-sm" onclick="doLogout()">ThoÃ¡t</button>
  `;
}

// â”€â”€ LOAD LOGIN STATS â”€â”€
async function loadLoginStats(){
  const s=await get(ref(db,'accounts'));
  const all=s.val()?Object.values(s.val()):[];
  document.getElementById('lStat1').textContent=all.filter(a=>!a.deleted).length;
  document.getElementById('lStat2').textContent=all.filter(a=>a.sold).length;
}

// â”€â”€ SHOP â”€â”€
async function loadShop(){
  const snap=await get(ref(db,'accounts'));
  allAccs=snap.val()?Object.entries(snap.val()).filter(([k,v])=>!v.deleted):[];
  renderShop();
  // update profile
  if(CUD){
    document.getElementById('myUID').textContent=CUD.uid;
    document.getElementById('bankNote').textContent=`Náº P TIá»€N ${CUD.uid}`;
    document.getElementById('pUID').textContent=CUD.uid;
    document.getElementById('pName').textContent=CU.displayName;
    document.getElementById('pEmail').textContent=CU.email;
    document.getElementById('pAvatar').src=CU.photoURL||'';
    document.getElementById('pBal').textContent=fmt(CUD.balance);
    document.getElementById('pIn').textContent=fmt(CUD.totalIn);
    document.getElementById('pOut').textContent=fmt(CUD.totalOut);
  }
}

window.selectGame=function(game,el){
  currentGame=game;
  document.querySelectorAll('#gameTabs .game-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderShop();
};
window.setType=function(type,el){
  currentType=type;
  document.querySelectorAll('.filter-row .filter-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  renderShop();
};
window.applyFilter=function(){renderShop()};

function renderShop(){
  const search=(document.getElementById('searchBox')?.value||'').toLowerCase();
  let list=allAccs.filter(([k,v])=>{
    if(currentGame!=='all'&&v.game!==currentGame)return false;
    if(currentType==='cheap'&&v.price>100000)return false;
    if(currentType==='vip'&&v.type!=='vip')return false;
    if(currentType==='rank'&&v.type!=='rank')return false;
    if(search&&!(v.name?.toLowerCase().includes(search)||v.desc?.toLowerCase().includes(search)||v.tags?.toLowerCase().includes(search)))return false;
    return true;
  });
  const grid=document.getElementById('shopGrid');
  if(!list.length){grid.innerHTML='<div class="empty"><div class="ei">ğŸ®</div>KhÃ´ng cÃ³ tÃ i khoáº£n phÃ¹ há»£p</div>';return;}
  grid.innerHTML=list.map(([key,acc])=>{
    const gm=GAMES[acc.game]||GAMES.other;
    const gameCls=`game-${acc.game||'other'}`;
    return `<div class="acc-card ${acc.sold?'sold':''}" onclick="openDetail('${key}')">
      <div class="card-img-wrap">
        ${acc.img?`<img src="${acc.img}" alt="" loading="lazy">`:`<div class="card-img-placeholder">${gm.icon}</div>`}
        <div class="card-overlay"></div>
        <div class="card-game-badge ${gameCls}">${gm.icon} ${gm.label}</div>
        ${acc.badge?`<div class="card-status-badge badge-${acc.badge}">${acc.badge==='hot'?'ğŸ”¥ Hot':'ğŸ†• Má»›i'}</div>`:''}
        ${acc.sold?'<div class="card-status-badge badge-sold">ÄÃ£ bÃ¡n</div>':''}
      </div>
      <div class="card-body">
        <div class="card-title">${acc.name}</div>
        <div class="card-desc">${acc.desc||''}</div>
        ${acc.tags?`<div class="card-tags">${acc.tags.split(',').map(t=>`<span class="tag">${t.trim()}</span>`).join('')}</div>`:''}
        <div class="card-footer">
          <div class="price">${fmt(acc.price)}</div>
          ${!acc.sold?`<button class="btn btn-gold btn-sm" onclick="event.stopPropagation();doBuy('${key}')">Mua ngay</button>`:'<span style="color:var(--muted);font-size:.78rem">ÄÃ£ bÃ¡n</span>'}
        </div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€ DETAIL â”€â”€
window.openDetail=function(key){
  const acc=allAccs.find(([k])=>k===key)?.[1];if(!acc)return;
  const gm=GAMES[acc.game]||GAMES.other;
  document.getElementById('dtTitle').textContent=acc.name;
  document.getElementById('dtBody').innerHTML=`
    ${acc.img?`<img src="${acc.img}" class="detail-img" alt="">`:`<div class="detail-img-ph">${gm.icon}</div>`}
    <div class="info-row"><span class="info-key">Game</span><span>${gm.icon} ${gm.label}</span></div>
    <div class="info-row"><span class="info-key">GiÃ¡ bÃ¡n</span><span style="color:var(--gold);font-weight:700;font-size:1.15rem">${fmt(acc.price)}</span></div>
    <div class="info-row"><span class="info-key">Loáº¡i</span><span>${acc.type||'ThÆ°á»ng'}</span></div>
    <div class="info-row"><span class="info-key">Tráº¡ng thÃ¡i</span><span style="color:${acc.sold?'var(--danger)':'var(--success)'}">${acc.sold?'âŒ ÄÃ£ bÃ¡n':'âœ… CÃ²n hÃ ng'}</span></div>
    ${acc.desc?`<div style="padding:12px 0;font-size:.85rem;line-height:1.75;color:#cbd5e1;border-bottom:1px solid rgba(255,255,255,.04)">${acc.desc}</div>`:''}
    ${acc.tags?`<div class="card-tags" style="margin:12px 0">${acc.tags.split(',').map(t=>`<span class="tag">${t.trim()}</span>`).join('')}</div>`:''}
    ${CU&&!acc.sold?`<button class="btn btn-gold" style="width:100%;margin-top:18px;padding:14px;font-size:1rem" onclick="closeOverlay('detailModal');doBuy('${key}')">ğŸ›’ Mua ngay â€“ ${fmt(acc.price)}</button>`:''}
    ${!CU&&!acc.sold?`<button class="btn btn-primary" style="width:100%;margin-top:18px" onclick="closeOverlay('detailModal');loginWithGoogle()">ÄÄƒng nháº­p Ä‘á»ƒ mua</button>`:''}
  `;
  document.getElementById('detailModal').classList.add('open');
};

// â”€â”€ BUY â”€â”€
window.doBuy=async function(key){
  if(!CU){loginWithGoogle();return;}
  await loadCUD();
  const snap=await get(ref(db,`accounts/${key}`));
  const acc=snap.val();if(!acc||acc.sold){showToast('TÃ i khoáº£n Ä‘Ã£ Ä‘Æ°á»£c bÃ¡n!','e');return;}
  if((CUD?.balance||0)<acc.price){showToast(`Sá»‘ dÆ° khÃ´ng Ä‘á»§! Cáº§n ${fmt(acc.price)}, báº¡n cÃ³ ${fmt(CUD?.balance||0)}`,'e');return;}
  if(!confirm(`XÃ¡c nháº­n mua "${acc.name}" vá»›i giÃ¡ ${fmt(acc.price)}?`))return;
  const newBal=(CUD.balance||0)-acc.price;
  await update(ref(db,`users/${CU.uid}`),{balance:newBal,totalOut:(CUD.totalOut||0)+acc.price});
  await update(ref(db,`accounts/${key}`),{sold:true,buyer:CU.email,soldAt:Date.now()});
  await push(ref(db,`transactions/${CU.uid}`),{type:`Mua ACC: ${acc.name}`,amount:-acc.price,loginInfo:acc.loginInfo||'',status:'done',time:Date.now()});
  CUD.balance=newBal;
  document.getElementById('navBal').textContent=fmt(newBal);
  showToast(`âœ… Mua thÃ nh cÃ´ng! Xem thÃ´ng tin Ä‘Äƒng nháº­p trong Lá»‹ch sá»­`);
  loadShop();
};

// â”€â”€ USER TABS â”€â”€
window.uTab=function(tab){
  ['shop','recharge','history','profile'].forEach(t=>{
    const el=document.getElementById(`uTab${t.charAt(0).toUpperCase()+t.slice(1)}`);
    if(el)el.style.display=t===tab?'block':'none';
  });
  // show/hide shop grid area
  const shopEl=document.getElementById('shopGrid');
  const gameTabEl=document.getElementById('gameTabs');
  const filterEl=document.querySelector('.filter-row');
  [shopEl,gameTabEl,filterEl].forEach(el=>{if(el)el.style.display=tab==='shop'?'':'none'});
  document.querySelectorAll('#userTabs .tab').forEach((b,i)=>b.classList.toggle('active',['shop','recharge','history','profile'][i]===tab));
  if(tab==='history')loadHistory();
};

async function loadHistory(){
  const snap=await get(ref(db,`transactions/${CU.uid}`));
  const tbody=document.getElementById('histBody');
  if(!snap.exists()){tbody.innerHTML='<tr><td colspan="4" style="text-align:center;color:var(--muted);padding:20px">ChÆ°a cÃ³ giao dá»‹ch</td></tr>';return;}
  const txs=Object.values(snap.val()).sort((a,b)=>b.time-a.time);
  tbody.innerHTML=txs.map(tx=>`<tr>
    <td style="font-size:.78rem">${new Date(tx.time).toLocaleString('vi-VN')}</td>
    <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${tx.type}</td>
    <td style="color:${tx.amount>0?'var(--success)':'var(--danger)'};font-weight:600">${tx.amount>0?'+':''}${fmt(tx.amount)}</td>
    <td><span style="color:${tx.status==='done'?'var(--success)':'var(--gold)'}">${tx.status==='done'?'âœ…':'â³'}</span></td>
  </tr>`).join('');
}

// â”€â”€ RECHARGE â”€â”€
window.selMethod=function(type,el){
  document.querySelectorAll('.recharge-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
  document.getElementById('cardFormPanel').style.display=type==='card'?'block':'none';
  document.getElementById('bankFormPanel').style.display=type==='bank'?'block':'none';
};
window.copyUID=function(){navigator.clipboard.writeText(CUD?.uid||'').then(()=>showToast('ÄÃ£ sao chÃ©p mÃ£ UID!'))};

window.submitCard=async function(){
  const cType=document.getElementById('cType').value;
  const cVal=parseInt(document.getElementById('cVal').value);
  const serial=document.getElementById('cSerial').value.trim();
  const code=document.getElementById('cCode').value.trim();
  if(!serial||!code){showToast('Nháº­p Ä‘á»§ seri vÃ  mÃ£ tháº»!','e');return;}
  const net=Math.floor(cVal*0.8);
  await push(ref(db,'recharges'),{uid:CUD.uid,userUid:CU.uid,email:CU.email,type:'card',cardType:cType,cardValue:cVal,serial,code,netValue:net,status:'pending',time:Date.now()});
  await push(ref(db,`transactions/${CU.uid}`),{type:`Náº¡p tháº» ${cType} ${fmt(cVal)}`,amount:net,status:'pending',time:Date.now()});
  document.getElementById('cSerial').value='';document.getElementById('cCode').value='';
  showToast(`ÄÃ£ gá»­i! Sau duyá»‡t báº¡n nháº­n ${fmt(net)}`);
};

// â”€â”€ ADMIN â”€â”€
async function loadAdminData(){
  const [accSnap,userSnap,rSnap]=await Promise.all([get(ref(db,'accounts')),get(ref(db,'users')),get(ref(db,'recharges'))]);
  const accs=accSnap.val()?Object.entries(accSnap.val()).filter(([k,v])=>!v.deleted):[];
  const users=userSnap.val()?Object.entries(userSnap.val()):[];
  const recharges=rSnap.val()?Object.entries(rSnap.val()):[];
  allAccs=accs;

  // stats
  document.getElementById('asTotalAcc').textContent=accs.length;
  document.getElementById('asSold').textContent=accs.filter(([k,v])=>v.sold).length;
  document.getElementById('asUsers').textContent=users.length;
  document.getElementById('asPending').textContent=recharges.filter(([k,v])=>v.status==='pending').length;

  // render accounts table (filtered)
  renderAdminAccs(accs, window._adminGameFilter||'all');

  // users
  const ub=document.getElementById('aUserBody');
  ub.innerHTML=users.length?users.map(([uid,u])=>`<tr>
    <td><div style="display:flex;align-items:center;gap:8px"><img src="${u.avatar||''}" style="width:28px;height:28px;border-radius:50%"><span>${u.name}</span></div></td>
    <td style="font-size:.78rem;color:var(--muted)">${u.email}</td>
    <td><code style="background:var(--surface2);padding:2px 7px;border-radius:4px;color:var(--accent);font-size:.82rem">${u.uid}</code></td>
    <td style="color:var(--gold);font-weight:600">${fmt(u.balance)}</td>
    <td><button class="btn btn-success btn-xs" onclick="openDirectAdd('${uid}','${u.name}','${u.email}')">+ Cá»™ng tiá»n</button></td>
  </tr>`).join(''):'<tr><td colspan="5" style="text-align:center;color:var(--muted);padding:20px">ChÆ°a cÃ³ ngÆ°á»i dÃ¹ng</td></tr>';

  // recharges
  const rb=document.getElementById('aRBody');
  const sorted=recharges.sort((a,b)=>b[1].time-a[1].time);
  rb.innerHTML=sorted.length?sorted.map(([key,r])=>`<tr>
    <td style="font-size:.75rem;white-space:nowrap">${new Date(r.time).toLocaleString('vi-VN')}</td>
    <td style="font-size:.77rem;color:var(--muted)">${r.email}</td>
    <td><code style="color:var(--accent)">${r.uid}</code></td>
    <td>${r.cardType||'â€”'}</td>
    <td style="color:var(--gold)">${fmt(r.cardValue||0)}</td>
    <td style="color:var(--success)">${fmt(r.netValue||0)}</td>
    <td><span style="color:${r.status==='done'?'var(--success)':'var(--gold)'}">${r.status==='done'?'âœ… Xong':'â³ Chá»'}</span></td>
    <td>${r.status!=='done'?`<button class="btn btn-success btn-xs" onclick="approveR('${key}','${r.userUid}',${r.netValue||0})">Duyá»‡t</button>`:''}</td>
  </tr>`).join(''):'<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:20px">ChÆ°a cÃ³ yÃªu cáº§u</td></tr>';
}

function renderAdminAccs(accs, filterGame){
  const list = filterGame==='all' ? accs : accs.filter(([k,v])=>v.game===filterGame);
  const tb=document.getElementById('aAccBody');
  tb.innerHTML=list.length?list.map(([key,acc])=>{
    const gm=GAMES[acc.game]||GAMES.other;
    return `<tr>
      <td>${acc.img?`<img src="${acc.img}" style="width:44px;height:36px;object-fit:cover;border-radius:6px">`:`<div style="width:44px;height:36px;background:var(--surface2);border-radius:6px;display:flex;align-items:center;justify-content:center">${gm.icon}</div>`}</td>
      <td style="font-weight:600;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${acc.name}</td>
      <td><span style="font-size:.8rem">${gm.icon} ${gm.label}</span></td>
      <td style="color:var(--gold);font-weight:600">${fmt(acc.price)}</td>
      <td><span style="color:${acc.sold?'var(--danger)':'var(--success)'};font-size:.82rem">${acc.sold?'ÄÃ£ bÃ¡n':'CÃ²n hÃ ng'}</span></td>
      <td><button class="btn btn-danger btn-xs" onclick="delAcc('${key}')">XoÃ¡</button></td>
    </tr>`;
  }).join(''):'<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:20px">KhÃ´ng cÃ³ tÃ i khoáº£n</td></tr>';
}

window.adminFilterGame=function(game,el){
  window._adminGameFilter=game;
  document.querySelectorAll('#adminGameFilter .game-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderAdminAccs(allAccs,game);
};

window.aTab=function(tab){
  ['accounts','users','recharges','lookup'].forEach(t=>{
    const el=document.getElementById(`aTab${t.charAt(0).toUpperCase()+t.slice(1)}`);
    if(el)el.style.display=t===tab?'block':'none';
  });
  document.querySelectorAll('#adminTabs .tab').forEach((b,i)=>b.classList.toggle('active',['accounts','users','recharges','lookup'][i]===tab));
  if(tab==='recharges'||tab==='users')loadAdminData();
};

// â”€â”€ ADD ACC â”€â”€
window.openAddModal=function(){
  editingKey=null;
  uploadedImgB64=null;
  document.getElementById('addModalTitle').textContent='â• ÄÄƒng tÃ i khoáº£n má»›i';
  ['nName','nDesc','nTags','nLogin'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('nPrice').value='';
  document.getElementById('imgPreview').style.display='none';
  document.getElementById('uploadPlaceholder').style.display='block';
  document.getElementById('imgFile').value='';
  document.getElementById('addAccErr').style.display='none';
  document.getElementById('addModal').classList.add('open');
};

window.submitAcc=async function(){
  const name=document.getElementById('nName').value.trim();
  const desc=document.getElementById('nDesc').value.trim();
  const price=parseInt(document.getElementById('nPrice').value);
  const game=document.getElementById('nGame').value;
  const type=document.getElementById('nType').value;
  const badge=document.getElementById('nBadge').value;
  const tags=document.getElementById('nTags').value.trim();
  const loginInfo=document.getElementById('nLogin').value.trim();
  const errEl=document.getElementById('addAccErr');
  if(!name||!price){errEl.textContent='âš ï¸ Vui lÃ²ng nháº­p tÃªn vÃ  giÃ¡!';errEl.style.display='block';return;}
  errEl.style.display='none';
  const btn=document.getElementById('submitAccBtn');btn.disabled=true;btn.textContent='Äang Ä‘Äƒng...';
  try{
    const data={name,desc,price,game,type,badge,tags,loginInfo,sold:false,createdAt:Date.now()};
    if(uploadedImgB64)data.img=uploadedImgB64;
    await push(ref(db,'accounts'),data);
    showToast('âœ… ÄÃ£ Ä‘Äƒng tÃ i khoáº£n thÃ nh cÃ´ng!');
    closeOverlay('addModal');
    loadAdminData();
    uploadedImgB64=null;
  }catch(e){showToast('Lá»—i: '+e.message,'e');}
  btn.disabled=false;btn.textContent='âœ… ÄÄƒng tÃ i khoáº£n';
};

window.delAcc=async function(key){
  if(!confirm('XÃ¡c nháº­n xoÃ¡ tÃ i khoáº£n nÃ y?'))return;
  await update(ref(db,`accounts/${key}`),{deleted:true,sold:true});
  showToast('ÄÃ£ xoÃ¡!');loadAdminData();
};

// â”€â”€ APPROVE RECHARGE â”€â”€
window.approveR=async function(key,userUid,amount){
  const uSnap=await get(ref(db,`users/${userUid}`));const u=uSnap.val();
  if(!u){showToast('KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng','e');return;}
  await update(ref(db,`users/${userUid}`),{balance:(u.balance||0)+amount,totalIn:(u.totalIn||0)+amount});
  await update(ref(db,`recharges/${key}`),{status:'done',approvedAt:Date.now()});
  const txSnap=await get(ref(db,`transactions/${userUid}`));
  if(txSnap.exists()){
    const txs=Object.entries(txSnap.val());
    const p=txs.find(([k,v])=>v.status==='pending'&&v.amount===amount);
    if(p)await update(ref(db,`transactions/${userUid}/${p[0]}`),{status:'done'});
  }
  showToast(`ÄÃ£ cá»™ng ${fmt(amount)} cho ${u.email}`);loadAdminData();
};

// â”€â”€ LOOKUP â”€â”€
window.doLookup=async function(){
  const uid=document.getElementById('lookUID').value.trim().toUpperCase();
  if(!uid){showToast('Nháº­p mÃ£ UID!','e');return;}
  const mapSnap=await get(ref(db,`uidMap/${uid}`));
  if(!mapSnap.exists()){showToast('KhÃ´ng tÃ¬m tháº¥y mÃ£ UID!','e');document.getElementById('lookResult').style.display='none';return;}
  lookupFbUid=mapSnap.val();
  const uSnap=await get(ref(db,`users/${lookupFbUid}`));lookupUid=uSnap.val();
  document.getElementById('lookResult').style.display='block';
  document.getElementById('lName').textContent=lookupUid.name;
  document.getElementById('lEmail').textContent=lookupUid.email;
  document.getElementById('lAvatar').src=lookupUid.avatar||'';
  document.getElementById('lBal').textContent=fmt(lookupUid.balance||0);
};
window.doAddBal=async function(){
  const amt=parseInt(document.getElementById('addAmt').value);
  if(!amt||amt<=0||!lookupFbUid){showToast('Nháº­p sá»‘ tiá»n há»£p lá»‡!','e');return;}
  const newBal=(lookupUid.balance||0)+amt;
  await update(ref(db,`users/${lookupFbUid}`),{balance:newBal,totalIn:(lookupUid.totalIn||0)+amt});
  await push(ref(db,`transactions/${lookupFbUid}`),{type:'Admin cá»™ng tiá»n',amount:amt,status:'done',time:Date.now()});
  lookupUid.balance=newBal;
  document.getElementById('lBal').textContent=fmt(newBal);
  document.getElementById('addAmt').value='';
  showToast(`ÄÃ£ cá»™ng ${fmt(amt)} cho ${lookupUid.email}`);
};

// â”€â”€ DIRECT ADD â”€â”€
window.openDirectAdd=function(uid,name,email){
  directAddTarget={uid,name,email};
  document.getElementById('dAddFor').textContent=`Cá»™ng tiá»n cho: ${name} (${email})`;
  document.getElementById('directAddModal').classList.add('open');
};
window.confirmDirectAdd=async function(){
  const amt=parseInt(document.getElementById('dAddAmt').value);
  if(!amt||amt<=0||!directAddTarget){showToast('Nháº­p sá»‘ tiá»n há»£p lá»‡!','e');return;}
  const snap=await get(ref(db,`users/${directAddTarget.uid}`));const u=snap.val();
  await update(ref(db,`users/${directAddTarget.uid}`),{balance:(u.balance||0)+amt,totalIn:(u.totalIn||0)+amt});
  await push(ref(db,`transactions/${directAddTarget.uid}`),{type:'Admin cá»™ng tiá»n',amount:amt,status:'done',time:Date.now()});
  showToast(`ÄÃ£ cá»™ng ${fmt(amt)} cho ${directAddTarget.email}`);
  closeOverlay('directAddModal');document.getElementById('dAddAmt').value='';loadAdminData();
};

// â”€â”€ OVERLAY CLOSE ON BG CLICK â”€â”€
document.querySelectorAll('.overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open')})});

// â”€â”€ INIT â”€â”€
loadLoginStats();
</script>
</body>
</html>
